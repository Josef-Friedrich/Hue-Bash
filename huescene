#! /bin/bash

SCENES_PATH="/root/hue/scenes"

function loop {
  (
    while true; do
      eval "$*"
    done
  ) &
  echo $! >> /var/run/hue.pids
}

function info {
  for SCENE in $(find /root/hue/scenes -name "*.scene"); do
    source $SCENE
    TOKEN=$(echo $SCENE | sed 's:.*/\(.*\).scene:\1:')
    echo "  -> $TOKEN ($TITLE: $DESCRIPTION)"
  done
}

function execute {
  SCENE="$SCENES_PATH/$1.scene"
  if [ -f "$SCENE" ]; then
    $SCENE
  else
    DEFAULT_SCENE="$SCENES_PATH/default.scene"
    if [ -f $DEFAULT_SCENE ]; then
      $DEFAULT_SCENE
    else
      info
    fi
  fi
}

case "$1" in

  info)
    echo "Available scenes:"
    info
    ;;

  stop)
    hue stop
    ;;

  *)
    execute
    ;;

esac
