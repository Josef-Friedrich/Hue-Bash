#! /bin/sh

. /etc/hue-shell/hue-shell.conf

_usage() {
	echo "USAGE
	hueload-scenes <options>

OPTIONS
	-e, --execute <scene>  Execute a light scene.

	-h, --help             Show this help message.

	-i, --info             Show all scenes.

	-r, --reset            Reset loaded scene.

	-s, --stop             Stop loaded scene.

DESCRIPTION
	'hueload-scenes' is a management tool for user generated light
	scenes. Light scenes scripts have to be put in $SCENES_PATH.
	File extensions of the scripts are '*.scene'.
"
}

##
# Show available scenes.
##
_info() {
	echo "Available scenes:"
	for SCENE in $(find $SCENES_PATH -name "*.scene"); do
	local TOKEN=$(echo $SCENE | sed 's:.*/\(.*\).scene:\1:')
	echo " -> $TOKEN"
	done
}

##
# Execute scene.
#
# - $1 = SCENE_TOKEN
##
_execute() {
	local SCENE="$SCENES_PATH/$1.scene"

	_hue_stop
	if [ -f "$SCENE" ]; then
		$SCENE
	else
		local DEFAULT_SCENE="$SCENES_PATH/$DEFAULT_SCENE.scene"
		$DEFAULT_SCENE
	fi
}

##
# Switch for scene functions.
##
case "$1" in

	-e|--execute)
		_execute $2
	;;

	-h|--help)
		_usage
	;;

	-i|--info)
		_info
	;;

	-r|--reset)
		_hue_reset
	;;

	-s|--stop)
		_hue_stop
	;;

	*)
		_usage
	;;

esac

# vim: set ts=8 sw=8 sts=8 et :
# sublime: tab_size 8;